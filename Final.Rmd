---
title: "STAT 380 Final Project"
author: "Brian Ellis and James Tondt"
date: "2023-04-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Front Matter
```{r}
rm(list = ls())
#Add libraries as needed
library(tidyverse)
library(knitr)
```

## Call of Duty

![](Call-of-Duty.jpg-d196774.png)

```{r}
# Load datasets
P1 <- read_csv(file = "CODGames_p1_380.csv", show_col_types = FALSE)
kable(head(P1))

P2 <- read_csv("CODGames_p2_380.csv", show_col_types = FALSE)
kable(head(P2))

Maps <- read_csv("CODMaps.csv")
kable(head(Maps))

Modes <- read_csv("CODGameModes.csv")
kable(Modes)
```

```{r}
# Appending Player 2 df to Player 1 df
Players <- P1 %>% 
  rbind(P2)
head(Players)
```

## Task 1 (Data Cleaning and Visualization)

Research Question: Which maps are the most likely to win the map vote? 

We will account for the fact that if there is a tie in voting, Map 1 is chosen by default. Therefore, we will locate whenever there is a tie and disregard the 'Choice' for that particular row. Games which are already underway already have the chosen map listed in choice so we don't care about the map votes for these rows. If we look at the variable 'Choice',
```{r}
sum(is.na(Players$Choice))
```
we see that there are only 2 NA values, so most of our data is present.

```{r}
unique(Players$Choice)
unique(Maps$Name)
```

We can see that there are more unique map names in our Players dataframe as compared with the list of all the map names from our Maps dataframe. This shows us there are misspellings in the map names in the Players dataframe that we must correct before calculating summary statistics.

```{r}
Maps %>% 
  full_join(Players, by = c("Name" = "Choice")) %>% 
  group_by(Name) %>% 
  summarize(Count = n())
```

Using this join query, we can see there are multiple misspellings, added spaces, and a couple NA values. We shall correct for all this before running summaries.

Before running summary statistics, we must clean the data contained within the Choice and Map variables

```{r}
# remove NAs from Choice
Players <- Players %>% 
  drop_na(Choice)
# Remove trailing or leading spaces
Players <- Players %>% 
  mutate(Choice = trimws(Choice),
         Map1 = trimws(Map1),
         Map2 = trimws(Map2))
# Fix name misspellings
#Players$Choice[Players$Choice == "APocalypse"] <- "Apocalypse" 

# Players %>% mutate(Choicespl = strsplit(Choice, " "),
#                    Choice = Choicespl[[2]][[1]])

# Define a list of misspellings and their correct spellings and specify certain spellings for words with spaces in their names with '\\W'
misspellings <- list("APocalypse" = "Apocalypse", "Apocolypse" = "Apocalypse", "\\bCollaterel Strike\\b" = "Collateral", "\\bCollateral Strike\\b" = "Collateral", "Deisel" = "Diesel", "Drive-in" = "Drive-In", "\\bMiami Strike\\b" = "Miami", "\\bNuketown\\b.*" = "Nuketown", "Riad" = "Raid")

# Loop through the misspellings list and apply regex to correct the misspellings
for (misspelling in names(misspellings)) {
  correction <- misspellings[[misspelling]]
  Players$Choice <- gsub(misspelling, correction, Players$Choice, ignore.case = TRUE)
}

# Run new query of count of Map names to see if typos were corrected
# Maps %>% 
#   full_join(Players, by = c("Name" = "Choice")) %>% 
#   group_by(Name) %>% 
#   summarize(Count = n())

Players %>% 
  group_by(Choice) %>% 
  summarise(count = n())
```

```{r, eval=FALSE}
# Try splitting the Map names into strings and use only the first part of the names as identifiers
ResultChar <- strsplit(Players$Choice, " ")

Choice_name <- rep(NA, length(ResultChar))

for (i in 1:length(ResultChar)) {
  Choice_name[i] <- (ResultChar[[i]][1])
}

# Convert choice into df
Choice_name <- data.frame(Name = Choice_name, stringsAsFactors = FALSE)
# Visualize
Players %>% 
  full_join(Choice_name, by = c("Choice" = "Name")) %>% 
  group_by(Choice) %>% 
  summarize(Count = n())
```


```{r}
# Vizualization of Choice
Players %>% 
  ggplot(aes(x = Choice)) +
  geom_histogram(stat = "count") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


```{r}
# Fixing typos in map names
Players$Map1[Players$Map1 == "APocalypse"] <- "Apocalypse" 
```


